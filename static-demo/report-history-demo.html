<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report History Demo - Mug Punters Investment Research Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        .text-gradient {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .loading-spinner {
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gradient">Mug Punters Investment Research Platform</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-3">
                        <div class="text-right">
                            <p class="text-sm font-medium text-gray-900">Demo User</p>
                            <p class="text-xs text-gray-500">demo@mugpunters.com</p>
                        </div>
                        <button class="p-2 text-gray-400 hover:text-gray-500 rounded-md">
                            <i data-lucide="user" class="h-6 w-6"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex">
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-sm border-r border-gray-200 min-h-screen">
            <div class="p-6">
                <h1 class="text-xl font-bold text-gradient">Mug Punters</h1>
            </div>
            
            <nav class="mt-6 px-3">
                <div class="space-y-1">
                    <a href="#dashboard" class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100">
                        <i data-lucide="home" class="mr-3 h-5 w-5 text-gray-400"></i>
                        Dashboard
                    </a>
                    <a href="#stocks" class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100">
                        <i data-lucide="trending-up" class="mr-3 h-5 w-5 text-gray-400"></i>
                        Stocks
                    </a>
                    <a href="#reports" class="group flex items-center px-3 py-2 text-sm font-medium rounded-md bg-blue-100 text-blue-700">
                        <i data-lucide="file-text" class="mr-3 h-5 w-5 text-blue-500"></i>
                        Reports
                    </a>
                    <a href="#portfolio" class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100">
                        <i data-lucide="briefcase" class="mr-3 h-5 w-5 text-gray-400"></i>
                        Portfolio
                    </a>
                    <a href="#watchlist" class="group flex items-center px-3 py-2 text-sm font-medium rounded-md text-gray-700 hover:bg-gray-100">
                        <i data-lucide="star" class="mr-3 h-5 w-5 text-gray-400"></i>
                        Watchlist
                    </a>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <main class="flex-1 p-6">
            <div class="max-w-7xl mx-auto space-y-6">
                <!-- Header -->
                <div class="flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Report History</h2>
                        <p class="text-gray-600">Track and compare your analysis performance over time</p>
                    </div>
                    <div class="text-sm text-gray-500">
                        <span id="report-count">3</span> of 3 reports
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-lg border border-gray-200 p-4">
                    <div class="flex items-center space-x-4">
                        <i data-lucide="filter" class="h-5 w-5 text-gray-400"></i>
                        <div class="flex space-x-4">
                            <select id="risk-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">All Risk Levels</option>
                                <option value="conservative">Conservative</option>
                                <option value="moderate">Moderate</option>
                                <option value="aggressive">Aggressive</option>
                            </select>
                            
                            <select id="timeframe-filter" class="border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">All Timeframes</option>
                                <option value="6m">6 Months</option>
                                <option value="1y">1 Year</option>
                                <option value="2y">2 Years</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Reports List -->
                <div id="reports-container" class="space-y-4">
                    <!-- Reports will be dynamically loaded here -->
                </div>

                <!-- Loading State -->
                <div id="loading-state" class="flex items-center justify-center h-64" style="display: none;">
                    <div class="loading-spinner rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="text-center py-12" style="display: none;">
                    <i data-lucide="bar-chart-3" class="mx-auto h-12 w-12 text-gray-400"></i>
                    <h3 class="mt-2 text-sm font-medium text-gray-900">No reports found</h3>
                    <p class="mt-1 text-sm text-gray-500">Try adjusting your filters to see more reports.</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Sample data
        const mockReports = [
            {
                id: '1',
                user_id: 'demo-user-123',
                stock_symbol: 'CBA',
                risk_level: 'moderate',
                timeframe: '1y',
                parameters: {
                    technical_indicators: ['RSI', 'MACD', 'SMA'],
                    fundamental_metrics: ['PE', 'PB', 'ROE'],
                    risk_factors: ['volatility', 'beta', 'sector']
                },
                results: {
                    technical_score: 75,
                    fundamental_score: 82,
                    risk_score: 68,
                    overall_score: 75,
                    recommendation: 'buy',
                    confidence: 0.78,
                    target_price: 95.50,
                    key_metrics: {
                        pe_ratio: 15.2,
                        pb_ratio: 1.8,
                        dividend_yield: 4.2
                    }
                },
                created_at: '2024-01-15T10:30:00Z',
                last_updated: '2024-01-15T10:30:00Z',
                performance: {
                    report_id: '1',
                    stock_symbol: 'CBA',
                    original_price: 88.50,
                    current_price: 92.30,
                    performance_pct: 4.29,
                    predicted_return: 7.9,
                    actual_return: 4.29,
                    accuracy_score: 0.54,
                    last_updated: '2024-01-20T15:45:00Z'
                }
            },
            {
                id: '2',
                user_id: 'demo-user-123',
                stock_symbol: 'BHP',
                risk_level: 'aggressive',
                timeframe: '6m',
                parameters: {
                    technical_indicators: ['RSI', 'Bollinger', 'Volume'],
                    fundamental_metrics: ['PE', 'Debt/Equity', 'ROA'],
                    risk_factors: ['commodity', 'currency', 'global']
                },
                results: {
                    technical_score: 68,
                    fundamental_score: 71,
                    risk_score: 45,
                    overall_score: 61,
                    recommendation: 'hold',
                    confidence: 0.65,
                    target_price: 42.80,
                    key_metrics: {
                        pe_ratio: 8.5,
                        debt_to_equity: 0.35,
                        roa: 12.1
                    }
                },
                created_at: '2024-01-10T14:20:00Z',
                last_updated: '2024-01-10T14:20:00Z',
                performance: {
                    report_id: '2',
                    stock_symbol: 'BHP',
                    original_price: 41.20,
                    current_price: 39.80,
                    performance_pct: -3.40,
                    predicted_return: 3.9,
                    actual_return: -3.40,
                    accuracy_score: 0.13,
                    last_updated: '2024-01-20T15:45:00Z'
                }
            },
            {
                id: '3',
                user_id: 'demo-user-123',
                stock_symbol: 'WBC',
                risk_level: 'conservative',
                timeframe: '2y',
                parameters: {
                    technical_indicators: ['SMA', 'EMA', 'MACD'],
                    fundamental_metrics: ['PE', 'Dividend Yield', 'Book Value'],
                    risk_factors: ['interest_rate', 'credit', 'regulatory']
                },
                results: {
                    technical_score: 72,
                    fundamental_score: 85,
                    risk_score: 78,
                    overall_score: 78,
                    recommendation: 'buy',
                    confidence: 0.82,
                    target_price: 28.50,
                    key_metrics: {
                        pe_ratio: 12.8,
                        dividend_yield: 5.1,
                        book_value: 22.40
                    }
                },
                created_at: '2024-01-05T09:15:00Z',
                last_updated: '2024-01-05T09:15:00Z',
                performance: {
                    report_id: '3',
                    stock_symbol: 'WBC',
                    original_price: 25.80,
                    current_price: 27.20,
                    performance_pct: 5.43,
                    predicted_return: 10.5,
                    actual_return: 5.43,
                    accuracy_score: 0.52,
                    last_updated: '2024-01-20T15:45:00Z'
                }
            }
        ];

        let currentReports = [...mockReports];
        let reEvaluating = new Set();

        // Initialize the app
        function init() {
            lucide.createIcons();
            loadReports();
            setupEventListeners();
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('risk-filter').addEventListener('change', filterReports);
            document.getElementById('timeframe-filter').addEventListener('change', filterReports);
        }

        // Load and display reports
        function loadReports() {
            const container = document.getElementById('reports-container');
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');

            // Show loading state briefly
            loadingState.style.display = 'flex';
            container.innerHTML = '';

            setTimeout(() => {
                loadingState.style.display = 'none';

                if (currentReports.length === 0) {
                    emptyState.style.display = 'block';
                    return;
                }

                emptyState.style.display = 'none';
                currentReports.forEach(report => {
                    const reportElement = createReportElement(report);
                    container.appendChild(reportElement);
                });

                // Update report count
                document.getElementById('report-count').textContent = currentReports.length;
            }, 500);
        }

        // Create report element
        function createReportElement(report) {
            const div = document.createElement('div');
            div.className = 'bg-white rounded-lg border border-gray-200 p-6 hover:shadow-md transition-shadow fade-in';
            div.innerHTML = `
                <div class="flex items-start justify-between">
                    <div class="flex-1">
                        <div class="flex items-center space-x-3 mb-3">
                            <h3 class="text-lg font-semibold text-gray-900">${report.stock_symbol}</h3>
                            <span class="px-2 py-1 rounded-full text-xs font-medium ${getRecommendationColor(report.results.recommendation)}">
                                ${report.results.recommendation.replace('_', ' ').toUpperCase()}
                            </span>
                            <span class="px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                ${report.risk_level.toUpperCase()}
                            </span>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                            <div class="space-y-2">
                                <div class="flex items-center text-sm text-gray-600">
                                    <i data-lucide="calendar" class="h-4 w-4 mr-2"></i>
                                    ${formatDate(report.created_at)}
                                </div>
                                <div class="flex items-center text-sm text-gray-600">
                                    <i data-lucide="clock" class="h-4 w-4 mr-2"></i>
                                    ${report.timeframe} timeframe
                                </div>
                            </div>

                            <div class="space-y-2">
                                <div class="text-sm">
                                    <span class="text-gray-600">Overall Score: </span>
                                    <span class="font-medium">${report.results.overall_score}/100</span>
                                </div>
                                <div class="text-sm">
                                    <span class="text-gray-600">Confidence: </span>
                                    <span class="font-medium">${(report.results.confidence * 100).toFixed(0)}%</span>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <div class="text-sm">
                                    <span class="text-gray-600">Target Price: </span>
                                    <span class="font-medium">$${report.results.target_price.toFixed(2)}</span>
                                </div>
                                ${report.performance ? `
                                    <div class="text-sm">
                                        <span class="text-gray-600">Current Price: </span>
                                        <span class="font-medium">$${report.performance.current_price.toFixed(2)}</span>
                                    </div>
                                ` : ''}
                            </div>
                        </div>

                        ${report.performance ? createPerformanceSection(report.performance) : ''}

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                            ${Object.entries(report.results.key_metrics).map(([key, value]) => `
                                <div class="text-center">
                                    <div class="font-medium text-gray-900">
                                        ${typeof value === 'number' ? value.toFixed(2) : value}
                                    </div>
                                    <div class="text-gray-600 capitalize">
                                        ${key.replace('_', ' ')}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="ml-4 flex flex-col space-y-2">
                        <button onclick="reEvaluateReport('${report.id}')" 
                                class="flex items-center px-3 py-2 text-sm font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 disabled:opacity-50 disabled:cursor-not-allowed"
                                id="re-eval-btn-${report.id}">
                            <i data-lucide="refresh-cw" class="h-4 w-4 mr-2"></i>
                            <span id="re-eval-text-${report.id}">Re-evaluate</span>
                        </button>
                        
                        <button class="flex items-center px-3 py-2 text-sm font-medium text-gray-600 bg-gray-50 rounded-md hover:bg-gray-100">
                            <i data-lucide="bar-chart-3" class="h-4 w-4 mr-2"></i>
                            View Details
                        </button>
                    </div>
                </div>
            `;
            return div;
        }

        // Create performance section
        function createPerformanceSection(performance) {
            return `
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <h4 class="text-sm font-medium text-gray-900 mb-3">Performance Tracking</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900">
                                ${performance.performance_pct > 0 ? '+' : ''}${performance.performance_pct.toFixed(2)}%
                            </div>
                            <div class="text-sm text-gray-600">Actual Return</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900">
                                ${performance.predicted_return > 0 ? '+' : ''}${performance.predicted_return.toFixed(1)}%
                            </div>
                            <div class="text-sm text-gray-600">Predicted Return</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold ${getAccuracyColor(performance.accuracy_score)}">
                                ${(performance.accuracy_score * 100).toFixed(0)}%
                            </div>
                            <div class="text-sm text-gray-600">Accuracy Score</div>
                        </div>
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gray-900">
                                $${performance.original_price.toFixed(2)}
                            </div>
                            <div class="text-sm text-gray-600">Original Price</div>
                        </div>
                    </div>
                    
                    <div class="mt-3 flex items-center justify-center">
                        ${getPerformanceIndicator(performance.accuracy_score)}
                    </div>
                </div>
            `;
        }

        // Re-evaluate report
        function reEvaluateReport(reportId) {
            if (reEvaluating.has(reportId)) return;

            reEvaluating.add(reportId);
            const btn = document.getElementById(`re-eval-btn-${reportId}`);
            const text = document.getElementById(`re-eval-text-${reportId}`);
            
            btn.disabled = true;
            text.innerHTML = '<div class="loading-spinner rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"></div>Re-evaluating...';

            // Simulate API call
            setTimeout(() => {
                // Update the report with new performance data
                const report = currentReports.find(r => r.id === reportId);
                if (report && report.performance) {
                    // Simulate price change
                    const priceChange = (Math.random() - 0.5) * 2;
                    report.performance.current_price += priceChange;
                    report.performance.performance_pct = ((report.performance.current_price - report.performance.original_price) / report.performance.original_price) * 100;
                    report.performance.actual_return = report.performance.current_price - report.performance.original_price;
                    report.performance.last_updated = new Date().toISOString();
                    
                    // Recalculate accuracy score
                    if (report.performance.predicted_return) {
                        const accuracy = 1.0 - Math.abs(report.performance.performance_pct - report.performance.predicted_return) / Math.abs(report.performance.predicted_return);
                        report.performance.accuracy_score = Math.max(0.0, Math.min(1.0, accuracy));
                    }
                }

                // Reset button
                btn.disabled = false;
                text.textContent = 'Re-evaluate';
                reEvaluating.delete(reportId);

                // Reload reports to show updated data
                loadReports();
            }, 2000);
        }

        // Filter reports
        function filterReports() {
            const riskFilter = document.getElementById('risk-filter').value;
            const timeframeFilter = document.getElementById('timeframe-filter').value;

            currentReports = mockReports.filter(report => {
                if (riskFilter !== 'all' && report.risk_level !== riskFilter) {
                    return false;
                }
                if (timeframeFilter !== 'all' && report.timeframe !== timeframeFilter) {
                    return false;
                }
                return true;
            });

            loadReports();
        }

        // Helper functions
        function getRecommendationColor(recommendation) {
            switch (recommendation) {
                case 'strong_buy':
                case 'buy':
                    return 'text-green-600 bg-green-100';
                case 'hold':
                    return 'text-yellow-600 bg-yellow-100';
                case 'sell':
                case 'strong_sell':
                    return 'text-red-600 bg-red-100';
                default:
                    return 'text-gray-600 bg-gray-100';
            }
        }

        function getAccuracyColor(accuracy) {
            if (accuracy >= 0.7) return 'text-green-600';
            if (accuracy >= 0.5) return 'text-yellow-600';
            return 'text-red-600';
        }

        function getPerformanceIndicator(accuracy) {
            if (accuracy >= 0.7) {
                return '<div class="flex items-center text-green-600"><i data-lucide="check-circle" class="h-5 w-5 mr-2"></i><span class="text-sm font-medium">High Accuracy</span></div>';
            } else if (accuracy >= 0.5) {
                return '<div class="flex items-center text-yellow-600"><i data-lucide="alert-triangle" class="h-5 w-5 mr-2"></i><span class="text-sm font-medium">Moderate Accuracy</span></div>';
            } else {
                return '<div class="flex items-center text-red-600"><i data-lucide="x-circle" class="h-5 w-5 mr-2"></i><span class="text-sm font-medium">Low Accuracy</span></div>';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-AU', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
